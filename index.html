<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ink and Obsidian Publications</title>
    <!-- Load Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind to use Inter font and define custom colors --><script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'sky-light': '#f0f9ff', // A very light sky blue for subtle accents
                        'sky-accent': '#0ea5e9', // Sky 500 for buttons/links
                        'obsidian': '#1f2937',  // Dark grey for text
                        'dark-bg': '#121212', // Deep dark background (No longer used, but kept in config for reference)
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff; /* Pure white background */
            color: #1f2937; /* Obsidian dark text */
        }

        /* --- Custom CSS for Smooth Transitions and Animations --- */
        .page-content {
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .page-content.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Navigation Link Hover/Active Styling */
        .nav-link, .mobile-nav-link {
            position: relative;
            padding-bottom: 2px;
            transition: color 0.3s;
        }
        
        .nav-link.active-nav, 
        .mobile-nav-link.active-nav {
            color: theme('colors.sky-accent'); 
        }

        .nav-link::after, .mobile-nav-link::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 0;
            height: 2px;
            background-color: theme('colors.sky-accent');
            transition: width 0.3s ease-in-out;
        }

        .nav-link:hover::after,
        .nav-link.active-nav::after,
        .mobile-nav-link:hover::after,
        .mobile-nav-link.active-nav::after {
            width: 100%;
        }

        /* Mobile Menu Transitions */
        .mobile-menu-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        .mobile-menu {
            transition: transform 0.3s ease-in-out;
        }

        .book-card, .contact-form-card, .bio-card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
        }

        /* --- ADVANCED SEARCH ANIMATIONS --- */

        /* 1. Rainbow Glow Keyframe (for border) */
        @keyframes rainbow-glow {
            0% { box-shadow: 0 0 10px 2px rgba(255, 0, 0, 0.7); border-color: rgba(255, 0, 0, 0.5); }
            14% { box-shadow: 0 0 10px 2px rgba(255, 165, 0, 0.7); border-color: rgba(255, 165, 0, 0.5); }
            28% { box-shadow: 0 0 10px 2px rgba(255, 255, 0, 0.7); border-color: rgba(255, 255, 0, 0.5); }
            42% { box-shadow: 0 0 10px 2px rgba(0, 128, 0, 0.7); border-color: rgba(0, 128, 0, 0.5); }
            56% { box-shadow: 0 0 10px 2px rgba(0, 0, 255, 0.7); border-color: rgba(0, 0, 255, 0.5); }
            70% { box-shadow: 0 0 10px 2px rgba(75, 0, 130, 0.7); border-color: rgba(75, 0, 130, 0.5); }
            84% { box-shadow: 0 0 10px 2px rgba(238, 130, 238, 0.7); border-color: rgba(238, 130, 238, 0.5); }
            100% { box-shadow: 0 0 10px 2px rgba(255, 0, 0, 0.7); border-color: rgba(255, 0, 0, 0.5); }
        }

        /* 2. Mirror Shine Keyframe (Applied to the Search Icon) */
        @keyframes mirror-shine {
            0%, 100% { 
                filter: brightness(1) drop-shadow(0 0 2px rgba(255, 255, 255, 0.4));
                transform: scale(1);
            }
            50% { 
                filter: brightness(1.5) drop-shadow(0 0 8px rgba(255, 255, 255, 0.8));
                transform: scale(1.05); /* Subtle pulse */
            }
        }

        /* 3. Helper Class to apply Rainbow Glow to the input */
        #book-search-input.rainbow-active {
            animation: rainbow-glow 6s linear infinite; /* Slow, continuous loop */
            border: 4px solid transparent !important; /* Override standard border */
            outline: none; /* Remove default blue focus outline */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06); /* Added subtle shadow when expanded */
        }
        
        /* 4. Helper Class to apply Mirror Shine to the button */
        .search-icon-shining {
            animation: mirror-shine 3s ease-in-out infinite;
        }

        /* 5. Ensure the input boundary is fully rounded when expanded */
        #book-search-input {
            padding-right: 3.5rem !important;
        }

        /* --- Updated Beating Heart Animation (Smoother Pulse) --- */
        @keyframes beat {
            0%, 100% {
                transform: scale(1);
                text-shadow: 0 0 4px rgba(255, 0, 0, 0.5); /* Soften glow */
            }
            50% { /* Changed 15% to 50% for smoother timing */
                transform: scale(1.1); /* Reduced scale for subtler beat */
                text-shadow: 0 0 8px rgba(255, 0, 0, 1); /* Sharpen glow at peak */
            }
        }
        .beating-heart {
            display: inline-block;
            /* Changed timing function to ease-in-out for smoothness */
            animation: beat 1.2s ease-in-out infinite; 
            color: red; 
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header / Navigation Bar --><header class="bg-sky-light sticky top-0 z-10 border-b border-sky-light/80 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center">
            
            <!-- Mobile Menu Toggle Button (LEFT SIDE on mobile) and Logo/Title -->
            <!-- The flex-row-reverse makes the button appear first (left) on mobile -->
            <div class="flex flex-row-reverse md:flex-row items-center justify-between w-full md:w-auto">
                
                <!-- Mobile Menu Toggle Button (Hamburger) -->
                <button class="md:hidden p-2 text-obsidian hover:text-sky-accent rounded-lg transition duration-200" 
                        onclick="toggleMobileMenu()" 
                        aria-label="Open mobile menu">
                    <!-- REPLACED SVG WITH IMG TAG -->
                    <img src="https://i.postimg.cc/J4vqbf4g/threeline.png" 
                         alt="Menu" 
                         class="w-7 h-7 object-contain"
                         onerror="this.onerror=null;this.src='https://placehold.co/28x28/1f2937/ffffff?text=M';">
                </button>

                <!-- Logo & Title -->
                <a href="#" onclick="navigate('home')" class="flex items-center space-x-3 transition duration-300 transform hover:scale-[1.01] ml-0 md:ml-0 mr-auto md:mr-0">
                    <!-- Logo Source updated to external link --><img src="https://i.postimg.cc/D0wkKkbS/Ink-Obsidian-Publications-main-logo.png"
                         alt="Ink and Obsidian Logo" 
                         class="h-8 w-8 object-contain shadow-md" 
                         onerror="this.onerror=null;this.src='https://placehold.co/32x32/1f2937/ffffff?text=I&O';" 
                         loading="lazy">
                    <span class="text-xl font-extrabold text-obsidian whitespace-nowrap">Ink & Obsidian Publications</span>
                </a>
            </div>

            <!-- Navigation Links (Desktop, Pushed to Right) -->
            <nav class="hidden md:flex space-x-8 items-center ml-auto">
                <a href="#" class="nav-link text-obsidian font-medium" data-page="home" onclick="navigate('home')">Home</a>
                <a href="#" class="nav-link text-obsidian font-medium" data-page="series" onclick="navigate('series')">Our Series</a>
                <a href="#" class="nav-link text-obsidian font-medium" data-page="books" onclick="navigate('books')">Our Books</a>
                <a href="#" class="nav-link text-obsidian font-medium" data-page="author" onclick="navigate('author')">The Visionary</a>
                <a href="#" class="nav-link text-obsidian font-medium" data-page="contact" onclick="navigate('contact')">Contact Us</a>
            </nav>
        </div>
    </header>

    <!-- Mobile Sidebar Menu Overlay --><div id="mobile-menu-overlay" 
         class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden mobile-menu-overlay opacity-0 md:hidden" 
         onclick="toggleMobileMenu()">
    </div>
    
    <!-- Mobile Sidebar Menu (Off-Canvas) --><div id="mobile-menu" 
         class="fixed top-0 right-0 w-64 h-full bg-white shadow-2xl z-30 transform translate-x-full mobile-menu md:hidden">
        
        <!-- Close Button --><div class="p-4 flex justify-end border-b border-sky-light">
            <button onclick="toggleMobileMenu()" class="text-obsidian hover:text-sky-accent p-2 rounded-full transition duration-200" aria-label="Close mobile menu">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>

        <!-- Navigation Links --><nav class="flex flex-col p-4 space-y-2">
            <!-- Used handleMobileNav to close the menu upon click --><a href="#" class="mobile-nav-link p-3 rounded-lg text-obsidian hover:bg-sky-light font-medium transition duration-200" data-page="home" onclick="handleMobileNav('home')">Home</a>
            <a href="#" class="mobile-nav-link p-3 rounded-lg text-obsidian hover:bg-sky-light font-medium transition duration-200" data-page="series" onclick="handleMobileNav('series')">Our Series</a>
            <a href="#" class="mobile-nav-link p-3 rounded-lg text-obsidian hover:bg-sky-light font-medium transition duration-200" data-page="books" onclick="handleMobileNav('books')">Our Books</a>
            <!-- UPDATED TEXT: The Author -> The Visionary --><a href="#" class="mobile-nav-link p-3 rounded-lg text-obsidian hover:bg-sky-light font-medium transition duration-200" data-page="author" onclick="handleMobileNav('author')">The Visionary</a>
            <a href="#" class="mobile-nav-link p-3 rounded-lg text-obsidian hover:bg-sky-light font-medium transition duration-200" data-page="contact" onclick="handleMobileNav('contact')">Contact Us</a>
        </nav>
    </div>

    <!-- Main Content Area - PRE-RENDERED HOME PAGE FOR IMMEDIATE VISIBILITY --><main id="content-container" class="page-content active flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <!-- START: Initial Home Page Content (Pre-rendered) --><div class="bio-card bg-white p-8 md:p-12 rounded-2xl shadow-xl border border-sky-light max-w-4xl mx-auto">
            <!-- Logo added here, centered and larger (h-32 w-32) --><div class="flex justify-center mb-6">
                <img src="https://i.postimg.cc/D0wkKkbS/Ink-Obsidian-Publications-main-logo.png"
                     alt="Ink and Obsidian Logo" 
                     class="h-32 w-32 object-contain" 
                     onerror="this.onerror=null;this.src='https://placehold.co/128x128/1f2937/ffffff?text=I&O';">
            </div>
            
            <h1 class="text-4xl font-black mb-6 text-sky-accent text-center">Welcome to Ink & Obsidian Publications</h1>
            <div class="space-y-6 text-lg text-gray-700 leading-relaxed">
                <p>
                    <strong>Ink & Obsidian Publications</strong> is an independent publishing imprint founded in 2025 with a commitment to storytelling in its purest form. From the eerie and haunting to the heartfelt and inspiring, the imprint embraces every shade of literature — **fantasy, thriller, romance, mystery, science fiction, folklore, and beyond.**
                </p>
                <p>
                    The name “Ink & Obsidian” symbolizes creativity and depth: ink as the timeless medium of expression, and obsidian as a stone of transformation, reflecting the wide spectrum of stories waiting to be told.
                </p>
                <p>
                    As a small but passionate publisher, Ink & Obsidian Publications values originality, imagination, and the courage to explore diverse genres. Its mission is to craft books that captivate, challenge, and resonate with readers worldwide — whether through the chill of a dark tale, the warmth of an emotional journey, or the excitement of an unexpected adventure.
                </p>
            </div>
        </div>
        <!-- END: Initial Home Page Content --></main>

    <!-- Footer --><footer class="bg-sky-light border-t border-sky-light/80 text-center py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <p class="text-sm font-semibold text-obsidian mb-2">
                © 2025 Ink & Obsidian Publications. All rights reserved.
            </p>
            <p class="text-xs text-gray-500 max-w-2xl mx-auto mb-3">
                All works published on this site are the original creations of Ink & Obsidian Publications. Unauthorized reproduction is prohibited.
            </p>
            <!-- NEW SOCIAL HANDLES SECTION -->
            <p class="text-xs text-gray-700 font-semibold mb-2">
                Follow our Social Handles:
            </p>
            <div class="flex justify-center space-x-4">
                <!-- INSTAGRAM LINK -->
                <a href='https://www.instagram.com/ink_obsidian_offcial/' target='_blank' rel='noopener noreferrer' aria-label="Instagram">
                    <img src='https://i.postimg.cc/jjGVfK6k/instagram-logo.png' 
                         alt='Instagram Logo' 
                         class="w-6 h-6 object-contain hover:scale-110 transition duration-300"
                         onerror="this.onerror=null;this.src='https://placehold.co/24x24/1f2937/ffffff?text=IG';">
                </a>
                <!-- X/TWITTER LINK -->
                <a href='https://x.com/ink_and_obsi' target='_blank' rel='noopener noreferrer' aria-label="X (formerly Twitter)">
                    <img src='https://i.postimg.cc/5NpZ38qt/X-logo.png' 
                         alt='X Logo' 
                         class="w-6 h-6 object-contain hover:scale-110 transition duration-300"
                         onerror="this.onerror=null;this.src='https://placehold.co/24x24/1f2937/ffffff?text=X';">
                </a>
            </div>
            <!-- NEW LINE WITH ANIMATED HEART -->
            <p class="text-xs text-gray-700 font-semibold mt-4">
                Made With <span class="beating-heart">❤️</span> in India
            </p>
        </div>
    </footer>

    <!-- JavaScript Logic --><script>
        // --- Core Data & State Management ---

        let currentPage = 'home';
        let currentBookId = null;
        let isSearchVisible = false;
        let isMobileMenuOpen = false; 
        
        // NEW: Track the previous page for the back button on book details
        let backButtonRoute = { page: 'books', id: null }; 

        // --- Shared Data for Silent Echoes (Vol-1) ---
        const bookDescription = "Silent Echoes From Dark World (Vol-1) is a collection of horror and psychological thriller tales woven from traditional folklores and beliefs of Europe, France, India, Japan, and China. Each story dives deep into shadows where myth collides with the darkest truths of the human mind. These are not softened fairy tales. They are brutal, visceral, and unrelenting—echoes of nightmares once whispered around fires, now resurrected for modern readers. This collection is intended strictly for mature readers above sixteen years of age. Those unprepared for psychological violence, disturbing imagery, and the chilling pulse of folklore reborn should turn away. These are not stories to be read lightly; they are doors into silence, and once you enter, the darkness will not release you unchanged";
        const bookGenre = "Historical, Horror, Supernatural, Traditional Folklore, Fantasy";
        const bookTags = "brutal crimes, mass killings, vulgar language, 16+, savage vengeance, and psychological torment";

        // --- Data for New Book (Book 3 & 4) ---
        const book3Description = "Welcome to Erotica: Unplugged – Not a Love Bite, a journey through desire, chaos, and the darker edges of the human psyche. This is not a love story. It is a story of obsession, betrayal, lust, and ruin — a mirror reflecting the raw, unfiltered impulses that simmer beneath the surface of our polished lives. This book is crafted strictly for readers aged eighteen and above. Within these pages lie explicit themes, intense dialogue, and mature reflections on desire and destruction — a provocative, psychological, and erotic journey that refuses to flinch from the truth of human impulses.";
        const book3Genre = "Dark Fantasy, Thriller, Psychological, Adult Drama";
        const book3Tags = "toxic relationship, sex, tobacco use, alcohol, slang words, metaphorical, dark fantasy, psychological thriller";
        
        // --- Data for New Book 5 & 6 (Kurukshetra) ---
        const book5Description = "In the unfathomable depths of time, where myth and history converge, stands the war of Kurukṣhetra—an eternal theatre of duty, despair, valor, and divine purpose. My 18 Perspectives of Kurukṣhetra – A Barbarik’s Narration of Mahābhābhārta is not merely a retelling of that immortal epic, but a philosophical excavation through the eyes of one who saw all—Barbarik, the silent spectator whose gaze transcended mortality and illusion alike. In these eighteen narrations—each corresponding to the eighteen fateful days of war—the battlefield becomes both a stage and a scripture. Through Barbarik’s vision, blood and dharma intertwine; arrows become verses, and the slain are transformed into eternal metaphors of human choice. This work seeks not to glorify violence, but to reveal the invisible philosophies veiled within it—the trembling balance between righteousness and ruin, action and consequence, faith and futility.";
        const book5Genre = "Historical, Mythological, Traditional, Sanatan, Warfare, Spiritual";
        const book5Tags = "mythological, spiritual, knowledge, Enlightening, history, ficton, narration";

        // --- Data for Silent Echoes Vol-2 (Book 7 & 8) ---
        const book7Description = "Silent Echoes From The Dark World (Vol–02) by Hreeshyat Talukdar is a descent into the macabre realm of folklore, tragedy, and psychological torment—crafted for readers who crave horror in its most unfiltered and literary form. Bending ancient myths with visceral modern storytelling, the collection resurrects monstrous tales from across the world: the vengeful whistle of El Silbón, the cannibalistic hunger of the Wendigo, the merciless duality of the Slavic Yaga, the beguiling Jorōgumo who weaves death through desire, and the blood-soaked laments of Strzyga and Vucodlak. Each story delves into the intersection of superstition and sanity, revealing not only the terrors of the supernatural but also the horrors concealed within human nature. Written with mature intensity and unapologetic realism, the book embraces explicit language, violence, sensuality, and despair—making it a harrowing experience designed exclusively for readers aged 18 and above.";
        const book7Genre = "Horror, Supernatural, Dark Fantasy, Traditional Folklore, 18+, Gore";
        const book7Tags = "brutality, cuss words, vulgar slangs, 18+, sexuality, psychological, mental torture";


        const booksData = [{
            id: 1,
            title: "Silent Echoes from Dark World (Vol-1) Paperback Version",
            coverUrl: "https://i.postimg.cc/JzZkk9Gy/1.jpg",
            pdfLink: "https://drive.google.com/uc?export=download&id=1hHp-STRAZrk6bGdTBNE1mw80nIfRKOEJ",
            description: bookDescription,
            placeholder: false,
            pageCount: 81,
            genre: bookGenre,
            tags: bookTags,
            storeLink: null // Hides the icon for Paperback version
        }, {
            id: 2,
            title: "Silent Echoes from Dark World (Vol-1) EPUB/RTF Version",
            coverUrl: "https://i.postimg.cc/SQrbGpZW/1.jpg", 
            pdfLink: "https://drive.google.com/uc?export=download&id=1FS1oNKghAIbV2f75PYk-0X2SRlb391NI",
            description: bookDescription,
            placeholder: false,
            pageCount: 75,
            genre: bookGenre,
            tags: bookTags,
            // CLICKABLE Google Play link
            storeLink: "https://play.google.com/store/books/details?id=BJ2LEQAAQBAJ"
        }, {
            // --- Book 3: Erotica Paperback ---
            id: 3,
            title: "Erotica Unplugged: Not A Love Bite (Paperback Version)",
            coverUrl: "https://i.postimg.cc/GtX9CGTN/1c.png",
            pdfLink: "https://drive.google.com/uc?export=download&id=10MT4qSzWpq_isO3PXaQlZsQnF18vQbsn",
            description: book3Description,
            placeholder: false,
            pageCount: 134,
            genre: "Dark Fantasy, Thriller, Psychological, Adult Drama",
            tags: book3Tags,
            storeLink: null // Hides the icon for Paperback version
        }, {
            // --- Book 4: Erotica EPUB/RTF ---
            id: 4,
            title: "Erotica Unplugged: Not A Love Bite (EPUB/RTF Version)",
            coverUrl: "https://i.postimg.cc/bNPKX4zy/1.png",
            pdfLink: "https://drive.google.com/uc?export=download&id=1aIEP7Z0vpWBzCilrHEPjZdqdL3R_MmRU",
            description: book3Description,
            placeholder: false,
            pageCount: 119,
            genre: "Dark Fantasy, Thriller, Psychological, Adult Drama",
            tags: book3Tags,
            // CLICKABLE Google Play link
            storeLink: "https://play.google.com/store/books/details?id=V0uNEQAAQBAJ"
        },
        {
            // --- Book 5: Mahabharata Narration (Paperback) ---
            id: 5,
            title: "My 18 Perspectives of Kurukṣhetra – A Barbarik’s Narration of Mahābhābhārta (PaperBack Version)",
            coverUrl: "https://i.postimg.cc/kGxpGKK0/1.png", 
            pdfLink: "https://drive.google.com/uc?export=download&id=182_NUVQKTxMLgqiMxbWRFxnA3YinJCAR",
            description: book5Description,
            placeholder: false,
            pageCount: 118, 
            genre: book5Genre,
            tags: book5Tags,
            storeLink: null // Hides the icon for Paperback version
        },
        {
            // --- Book 6: Mahabharata Narration (RTF) ---
            id: 6,
            title: "My 18 Perspectives of Kurukṣhetra – A Barbarik’s Narration of Mahābhābhārta (RTF version)",
            coverUrl: "https://i.postimg.cc/3xLbkK0k/1c.png", 
            pdfLink: "https://drive.google.com/uc?export=download&id=1H_9wavF5KvB0BqmS7_9Zmv_oFbrWqqtM", 
            description: book5Description,
            placeholder: false,
            pageCount: 96, 
            genre: book5Genre,
            tags: book5Tags,
            storeLink: "https://play.google.com/store/books/details?id=KrKNEQAAQBAJ"
        },
        {
            // --- Book 7: Silent Echoes Vol-2 (Paperback) ---
            id: 7,
            title: "Silent Echoes from Dark World (Vol-2) Paperback Version (For 18+ Readers)",
            coverUrl: "https://i.postimg.cc/rydwF94f/1.png", 
            pdfLink: "https://drive.google.com/uc?export=download&id=1vERZC-cjtdDKOJxuR2_3WSV9NhUHUEaa",
            description: book7Description,
            placeholder: false,
            pageCount: 204,
            genre: book7Genre,
            tags: book7Tags,
            storeLink: null // Hides the icon for Paperback version
        },
        {
            // --- Book 8: Silent Echoes Vol-2 (EPUB/RTF) ---
            id: 8,
            title: "Silent Echoes from Dark World (Vol-2) EPUB/RTF Version (For 18+ Readers)",
            coverUrl: "https://i.postimg.cc/MppmzxtK/1c.png", 
            pdfLink: "https://drive.google.com/uc?export=download&id=1q3BaReI5aFIOctnU5UCCndbh21436nCG",
            description: book7Description,
            placeholder: false,
            pageCount: 264,
            genre: book7Genre,
            tags: book7Tags,
            // UPDATED GOOGLE PLAY LINK FOR BOOK 8
            storeLink: "https://play.google.com/store/books/details?id=5rWPEQAAQBAJ"
        },
        // --- Book 9: Erotica Unplugged: The Night Fall (Paperback) ---
        {
            id: 9,
            title: "Erotica Unplugged: The Night Fall (Paperback Version)",
            coverUrl: "https://i.postimg.cc/c4vPJRh8/1.png",
            pdfLink: "https://drive.google.com/uc?export=download&id=1V7a_YscOuODcbHPhLQkbz00mF7J4Ae5X",
            // CORRECTED DESCRIPTION
            description: "Erotica Unplugged: The Night Fall exists beyond conventional narrative boundaries—a psychological excavation disguised as dark fantasy, exploring humanity's attraction toward its own annihilation. This is not sanitized fiction. Within these pages, you'll encounter explicit sexuality, substance abuse, psychological manipulation, and transgressive content deliberately crafted to disturb comfortable sensibilities. The narrative employs sophisticated vocabulary and metaphorical darkness to examine how trauma sculpts desire, how manipulation masquerades as intimacy, and how individuals court destruction while believing they maintain control.",
            placeholder: false,
            pageCount: 94,
            genre: "Dark Fantasy, Thriller, Psychological, Adult Drama, Strong",
            tags: "LGBTQ, toxic relationship, tobacco Use, drugs, slangs, metaphorical, suspense, thriller",
            storeLink: null // Paperback version
        },
        // --- NEW BOOK: Erotica Unplugged: The Night Fall (RTF) - ID 10 ---
        {
            id: 10,
            title: "Erotica Unplugged: The Night Fall (RTF Version)",
            coverUrl: "https://i.postimg.cc/0jV6Hg3h/image.png",
            pdfLink: "https://drive.google.com/uc?export=download&id=1sB38OdogCl0uEUcUnOG3-U_fGqOjnil1",
            description: "Erotica Unplugged: The Night Fall exists beyond conventional narrative boundaries—a psychological excavation disguised as dark fantasy, exploring humanity's attraction toward its own annihilation. This is not sanitized fiction. Within these pages, you'll encounter explicit sexuality, substance abuse, psychological manipulation, and transgressive content deliberately crafted to disturb comfortable sensibilities. The narrative employs sophisticated vocabulary and metaphorical darkness to examine how trauma sculpts desire, how manipulation masquerades as intimacy, and how individuals court destruction while believing they maintain control.",
            placeholder: false,
            pageCount: 87,
            genre: "Dark Fantasy, Thriller, Psychological, Adult Drama, Strong",
            tags: "LGBTQ, toxic relationship, tobacco Use, drugs, slangs, metaphorical, suspense, thriller",
            // ACTIVATING GOOGLE PLAY LINK FOR BOOK 10
            storeLink: "https://play.google.com/store/books/details?id=2Z-TEQAAQBAJ"
        }
    ];

    // --- NEW: Series Data Structure ---
    const seriesData = [
        {
            id: 'silent-echoes',
            title: 'Silent Echoes from Dark World',
            seriesLogo: 'https://i.postimg.cc/y83Wmb8T/Silent-Echoes-From-the-Dark-World.png',
            description: "Silent Echoes From The Dark World is a dark folklore and psychological horror anthology series that transcends age boundaries—crafted for mature teens and adult readers who crave the thrill of mythic terror. Each volume resurrects forgotten legends from across the world, merging ancient traditions with modern storytelling to evoke both fear and fascination. Every story unfolds as an unsettling journey through folklore’s most shadowed corridors—where superstition, sin, and humanity intertwine in poetic horror. This series invites readers to confront their fears, explore the duality of myth and morality, and lose themselves in the haunting echoes that linger between reality and nightmare.",
            bookIds: [1, 2, 7, 8],
        },
        {
            id: 'erotica-unplugged',
            title: 'Erotica Unplugged',
            // --- UPDATED LOGO ---
            seriesLogo: 'https://i.postimg.cc/cChC4vBj/Erotica-Unplugged.png',
            // --- DESCRIPTION UPDATED ---
            description: "“Erotica Unplugged” unfolds as a Shakespearean symphony drenched in modern excess, where desire rots into despair and passion burns beneath the shadow of guilt. Within its dark fantasy realm, love festers amid lust, betrayal, and moral decay, each verse echoing the poetry of ruin. Characters indulge in sin like art—tobacco-stained, drink-soaked souls lost in eloquent profanity. Every dialogue drips with metaphor, every scene a dance between sanity and seduction. A psychological thriller that strips romance bare, exposing its venom—this 18+ saga is not for the faint-hearted, but for those who crave truth in corrupted beauty. ", 
            // --- ADDED NEW BOOK ID 9 & 10 ---
            bookIds: [3, 4, 9, 10],
        },
        // REMOVED 'kurukshetra' SERIES ENTRY
    ];

    /**
     * Helper function to filter books by series ID.
     * @param {string} seriesId - The ID of the series to filter by.
     * @returns {Array} - The list of books belonging to that series.
     */
    function getBooksBySeriesId(seriesId) {
        const series = seriesData.find(s => s.id === seriesId);
        if (!series) return [];
        return booksData.filter(book => series.bookIds.includes(book.id));
    }

    /**
     * Helper function to get the series ID for a given book ID.
     * @param {number} bookId - The ID of the book.
     * @returns {string|null} - The ID of the series the book belongs to, or null.
     */
    function getSeriesIdByBookId(bookId) {
        for (const series of seriesData) {
            if (series.bookIds.includes(bookId)) {
                return series.id;
            }
        }
        return null;
    }


        // --- Utility Functions ---

        /**
         * Simple SVG for the Search icon (Lucide style)
         */
        function getSearchIcon() {
            return `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            `;
        }
        
        /**
         * Simple SVG for the Download/Get It icon (Lucide style)
         */
        function getDownloadIcon() {
            return `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
            `;
        }
        
        /**
         * Simple SVG for the Mail/Send icon (Lucide style)
         */
        function getSendIcon() {
            return `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                    <path d="m22 2-7 20-4-9-9-4 20-7z"></path>
                    <path d="M12 12 19 5"></path>
                </svg>
            `;
        }

        // SVG for the simple back arrow icon (Lucide style)
        function getBackIcon() {
            return `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                    <path d="m15 18-6-6 6-6"/>
                </svg>
            `;
        }
        
        /**
         * Toggles the visibility of the mobile menu sidebar and overlay.
         */
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const overlay = document.getElementById('mobile-menu-overlay');
            const body = document.body;

            isMobileMenuOpen = !isMobileMenuOpen;

            if (isMobileMenuOpen) {
                // Show Menu
                overlay.classList.remove('hidden', 'opacity-0');
                overlay.classList.add('opacity-100');
                menu.classList.remove('translate-x-full');
                // Prevent background scrolling
                body.style.overflow = 'hidden';
            } else {
                // Hide Menu
                overlay.classList.remove('opacity-100');
                overlay.classList.add('opacity-0');
                menu.classList.add('translate-x-full');
                // Re-enable background scrolling after transition
                setTimeout(() => {
                    overlay.classList.add('hidden');
                    body.style.overflow = '';
                }, 300); // Match CSS transition duration
            }
        }

        /**
         * Handles mobile navigation, calls navigate(), and closes the menu.
         */
        function handleMobileNav(page) {
            navigate(page);
            // Close the menu after navigation
            if (isMobileMenuOpen) {
                toggleMobileMenu();
            }
        }
        
        /**
         * Handles the form submission by constructing a mailto link.
         * @param {Event} event - The form submission event.
         */
        function handleContactSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const name = form.name.value;
            const email = form.email.value;
            const subject = form.subject.value;
            const message = form.message.value;
            const messageDiv = document.getElementById('contact-message');

            // The target Gmail address
            const recipient = 'inkandobsidianpublications@gmail.com'; // CORRECT EMAIL

            // Construct the mailto link
            const bodyContent = `Dear Ink & Obsidian Publications Team,\n\n${message}\n\n---\nSender: ${name} (${email})`;
            const mailtoLink = `mailto:${recipient}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(bodyContent)}`;

            // Open the user's default email client
            window.location.href = mailtoLink;

            // Display a non-alert message
            messageDiv.textContent = 'Your message is being prepared in your email client. Please click "Send" there to complete the action.';
            messageDiv.className = 'mt-4 p-3 bg-sky-light text-sky-accent rounded-lg text-center block';

            // Optionally clear the form after a short delay
            setTimeout(() => {
                form.reset();
                messageDiv.textContent = '';
                messageDiv.className = 'mt-4 p-3 rounded-lg text-center hidden';
            }, 5000);
        }
        
        // --- Page Content Rendering Functions ---
        function renderHome() {
            return `
                <div class="bio-card bg-white p-8 md:p-12 rounded-2xl shadow-xl border border-sky-light max-w-4xl mx-auto">
                    <!-- Logo added here, centered and larger (h-32 w-32) --><div class="flex justify-center mb-6">
                        <img src="https://i.postimg.cc/D0wkKkbS/Ink-Obsidian-Publications-main-logo.png"
                             alt="Ink and Obsidian Logo" 
                             class="h-32 w-32 object-contain" 
                             onerror="this.onerror=null;this.src='https://placehold.co/128x128/1f2937/ffffff?text=I&O';">
                    </div>

                    <h1 class="text-4xl font-black mb-6 text-sky-accent text-center">Welcome to Ink & Obsidian Publications</h1>
                    <div class="space-y-6 text-lg text-gray-700 leading-relaxed">
                        <p>
                            <strong>Ink & Obsidian Publications</strong> is an independent publishing imprint founded in 2025 with a commitment to storytelling in its purest form. From the eerie and haunting to the heartfelt and inspiring, the imprint embraces every shade of literature — **fantasy, thriller, romance, mystery, science fiction, folklore, and beyond.**
                        </p>
                        <p>
                            The name “Ink & Obsidian” symbolizes creativity and depth: ink as the timeless medium of expression, and obsidian as a stone of transformation, reflecting the wide spectrum of stories waiting to be told.
                        </p>
                        <p>
                            As a small but passionate publisher, Ink & Obsidian Publications values originality, imagination, and the courage to explore diverse genres. Its mission is to craft books that captivate, challenge, and resonate with readers worldwide — whether through the chill of a dark tale, the warmth of an emotional journey, or the excitement of an unexpected adventure.
                        </p>
                    </div>
                </div>
            `;
        }

        function renderAuthor() {
            return `
                <div class="bio-card bg-white p-8 md:p-12 rounded-2xl shadow-xl border border-sky-light max-w-4xl mx-auto">
                    <h1 class="text-4xl font-black mb-6 text-sky-accent text-center">Hreeshyat Talukdar</h1>
                    <div class="space-y-6 text-lg text-gray-700 leading-relaxed">
                        <p>
                            Hreeshyat is a 19-year-old storyteller from Assam, India, with a profound passion for exploring the limitless realms of imagination. Fascinated by the power of words, he crafts stories across a variety of genres—from chilling horror and psychological thrillers to **fantasy, folklore, and emotional dramas.**
                        </p>
                        <p>
                            Despite his young age, Hreeshyat has shown a remarkable ability to blend cultural traditions, historical references, and human psychology into compelling narratives that grip the reader from the first page. His writing reflects a deep curiosity about the human mind, society, and the myths that shape civilizations, allowing him to weave tales that are both entertaining and thought-provoking.
                        </p>
                        <p class="text-center pt-4 italic text-gray-500">
                            "The deepest truths often lie where the shadows meet the ink."
                        </p>
                    </div>
                </div>
            `;
        }

        function renderContact() {
            return `
                <div class="contact-form-card bg-white p-6 md:p-10 rounded-2xl shadow-xl border border-sky-light max-w-xl mx-auto">
                    <h1 class="text-4xl font-black mb-6 text-sky-accent text-center">Connect With Us</h1>
                    <!-- UPDATED TEXT: Hreeshyat's email -> our official email --><p class="text-gray-600 mb-6 text-center">We'd love to hear from you. Send your message directly to our official email.</p>

                    <form id="contact-form" onsubmit="handleContactSubmit(event)" class="space-y-5">
                        <div class="space-y-2">
                            <label for="name" class="block text-sm font-medium text-obsidian">Your Name</label>
                            <input type="text" id="name" name="name" required
                                class="w-full p-3 border border-gray-300 rounded-lg input-focus transition duration-200">
                        </div>

                        <div class="space-y-2">
                            <label for="email" class="block text-sm font-medium text-obsidian">Your Email</label>
                            <input type="email" id="email" name="email" required
                                class="w-full p-3 border border-gray-300 rounded-lg input-focus transition duration-200">
                        </div>

                        <div class="space-y-2">
                            <label for="subject" class="block text-sm font-medium text-obsidian">Subject</label>
                            <input type="text" id="subject" name="subject" required
                                class="w-full p-3 border border-gray-300 rounded-lg input-focus transition duration-200">
                        </div>

                        <div class="space-y-2">
                            <label for="message" class="block text-sm font-medium text-obsidian">Message</label>
                            <textarea id="message" name="message" rows="5" required
                                class="w-full p-3 border border-gray-300 rounded-lg input-focus transition duration-200"></textarea>
                        </div>

                        <button type="submit"
                            class="w-full flex items-center justify-center bg-sky-accent text-white py-3 px-4 rounded-lg font-semibold hover:bg-sky-700 transition duration-300 shadow-lg shadow-sky-accent/30 transform hover:scale-[1.01]">
                            ${getSendIcon()}
                            <span class="ml-2">Send</span>
                        </button>
                    </form>

                    <div id="contact-message" class="mt-4 p-3 rounded-lg text-center hidden"></div>
                </div>
            `;
        }
        
        // --- RENDER SERIES LIST PAGE (Now renders all series) ---
        function renderSeriesList() {
            const seriesCards = seriesData.map(series => {
                // Determine if a description exists
                const hasDescription = series.description && series.description.trim().length > 0;

                return `
                    <div class="bio-card bg-white p-6 md:p-12 rounded-2xl shadow-xl border border-sky-light max-w-4xl mx-auto mb-10 last:mb-0">
                        <div class="flex flex-col md:flex-row items-center md:items-start gap-8">
                            <!-- Large Logo -->
                            <div class="flex-shrink-0">
                                <img src="${series.seriesLogo}" 
                                     alt="${series.title} Series Logo" 
                                     class="w-48 h-48 object-contain rounded-xl shadow-lg border border-gray-100" 
                                     onerror="this.onerror=null;this.src='https://placehold.co/192x192/1f2937/ffffff?text=Series+Logo';">
                            </div>
                            
                            <!-- Title, Description, and Link -->
                            <div class="flex-grow text-center md:text-left pt-4">
                                <h2 class="text-3xl font-extrabold mb-2 text-obsidian">
                                    ${series.title}
                                </h2>
                                
                                <!-- SERIES DESCRIPTION (Conditional Rendering) -->
                                ${hasDescription ? `
                                    <p class="text-gray-700 mb-4 text-sm md:text-base leading-relaxed">
                                        ${series.description}
                                    </p>
                                ` : '' /* Removed the placeholder text */}

                                <!-- Link to Series Detail Page (Navy Blue Text) -->
                                <a href="#" onclick="navigate('series-detail', '${series.id}')" 
                                   class="inline-flex items-center text-lg font-bold text-blue-800 hover:text-sky-accent transition duration-200">
                                    See our books <span class="ml-2">>>></span>
                                </a>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            return `
                <h1 class="text-4xl font-black mb-10 text-sky-accent text-center">Our Series</h1>
                ${seriesCards}
            `;
        }

        // --- NEW: RENDER SERIES DETAIL PAGE ---
        function renderSeriesDetail(seriesId) {
            const series = seriesData.find(s => s.id === seriesId);
            if (!series) return `<p class="text-center text-red-500">Series not found.</p>`;

            const filteredBooks = getBooksBySeriesId(seriesId);

            const bookCards = filteredBooks.map(book => `
                <div class="book-card bg-white p-4 rounded-xl text-center cursor-pointer border border-sky-light"
                    onclick="navigate('book-detail', ${book.id})">
                    <!-- Book Cover --><img src="${book.coverUrl}" alt="${book.title} cover" class="w-full h-auto object-cover rounded-lg mx-auto shadow-md"
                        onerror="this.onerror=null;this.src='https://placehold.co/150x225/f0f9ff/101010?text=I&O';" loading="lazy">

                    <!-- Title --><p class="mt-3 text-sm font-semibold text-obsidian">${book.title}</p>
                </div>
            `).join('');

            return `
                <!-- Updated Back Button: Icon only, redirects to Our Series -->
                <button onclick="navigate('series')" class="flex items-center text-sky-accent hover:text-sky-700 font-semibold mb-6 transition duration-300 p-2 rounded-full" aria-label="Back to Our Series">
                    ${getBackIcon()}
                </button>
                
                <h1 class="text-4xl font-black mb-10 text-obsidian text-center">Books in the <span class="text-sky-accent">${series.title}</span> Series</h1>

                <!-- Book Grid (6 books per row - adjusted to automatically fit content) -->
                <div id="book-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-6">
                    ${bookCards}
                </div>
            `;
        }

        function renderBookDetail(bookId) {
            const book = booksData.find(b => b.id === bookId);
            if (!book) return '<p class="text-center text-red-500">Book not found.</p>';

            // Determine the back button handler based on the page the user navigated from (stored in backButtonRoute)
            let backHandler;
            let ariaLabel;

            if (backButtonRoute.page === 'series-detail' || backButtonRoute.page === 'series') {
                // If the book was accessed via the series section, go back to Our Series.
                backHandler = "navigate('series')";
                ariaLabel = "Back to Our Series";
            } else {
                // Default: if accessed via Our Books or any other page, go back to Our Books.
                backHandler = "navigate('books')";
                ariaLabel = "Back to Our Books";
            }


            // Define the URL for the Google Play logo
            const googlePlayLogoUrl = "https://i.postimg.cc/9Fv9xyhF/google-play-store-mobile-apps-logo-free-png.webp";

            // Conditionally render the store link button using the logo
            let storeButton = '';

            // Logic: Show the icon if storeLink is not null (Paperback uses null to hide).
            if (book.storeLink !== null) {
                // Determine if it's a clickable link or a static button
                const isClickable = typeof book.storeLink === 'string' && book.storeLink.startsWith('http');
                const tagType = isClickable ? 'a' : 'button';
                const hrefAttr = isClickable ? `href="${book.storeLink}" target="_blank" rel="noopener noreferrer"` : 'onclick="return false;"';
                const cursorClass = isClickable ? 'cursor-pointer hover:bg-sky-light' : 'cursor-default opacity-50';

                storeButton = `
                    <${tagType} ${hrefAttr}
                        title="${isClickable ? 'View on Google Play Books' : 'Store link coming soon'}"
                        class="inline-flex items-center justify-center bg-white border-2 border-sky-accent text-sky-accent p-2 rounded-full font-bold text-lg transition duration-300 shadow-xl shadow-sky-accent/40 transform hover:scale-[1.05] ${cursorClass}">
                        <img src="${googlePlayLogoUrl}" alt="Google Play Books Logo" class="w-8 h-8 object-contain rounded-full">
                    </${tagType}>
                `;
            }
            
            // Share Button HTML removal confirmed

            return `
                <div class="bg-white p-8 md:p-12 rounded-2xl shadow-xl border border-sky-light max-w-5xl mx-auto">
                    <!-- Updated Back Button: Icon only, handler changes dynamically based on origin -->
                    <button onclick="${backHandler}" class="flex items-center text-sky-accent hover:text-sky-700 font-semibold mb-6 transition duration-300 p-2 rounded-full" aria-label="${ariaLabel}">
                        ${getBackIcon()}
                    </button>

                    <div class="flex flex-col lg:flex-row gap-10">
                        <!-- Book Cover (Small Size) --><div class="flex-shrink-0 mx-auto lg:mx-0">
                            <!-- CHANGE: Removed h-48 and set w-48 (or w-56 for a slightly bigger look) to maintain aspect ratio -->
                            <img src="${book.coverUrl}" alt="${book.title} cover" class="w-56 h-auto object-cover rounded-xl shadow-2xl transition duration-500 transform hover:scale-[1.03]" onerror="this.onerror=null;this.src='https://placehold.co/192x288/1f2937/ffffff?text=Book+Cover';" loading="lazy">
                        </div>

                        <!-- Book Details --><div class="flex-grow">
                            <h2 class="text-5xl font-extrabold mb-4 text-obsidian">${book.title}</h2>
                            
                            <div class="space-y-6 text-lg text-gray-700 leading-relaxed">
                                <p>${book.description}</p>
                            </div>

                            <div class="mt-4 space-y-1">
                                <!-- Display Total Pages -->${book.pageCount ? `
                                    <p class="text-lg font-semibold text-obsidian">
                                        Total Pages: <span class="text-sky-accent">${book.pageCount}</span>
                                    </p>
                                ` : ''}

                                <!-- Display Genre -->${book.genre ? `
                                    <p class="text-lg font-semibold text-obsidian">
                                        Genre: <span class="text-sky-accent">${book.genre}</span>
                                    </p>
                                ` : ''}
                                
                                <!-- Display Tags -->${book.tags ? `
                                    <p class="text-lg font-semibold text-obsidian">
                                        Tags: <span class="text-sky-accent">${book.tags}</span>
                                    </p>
                                ` : ''}
                            </div>
                            
                            ${!book.placeholder ? `
                                <div class="mt-8 flex items-center space-x-4 relative">
                                    <!-- 1. Get It Button --><a href="${book.pdfLink}" target="_blank" rel="noopener noreferrer"
                                        class="inline-flex items-center bg-sky-accent text-white py-3 px-6 rounded-lg font-bold text-lg hover:bg-sky-700 transition duration-300 shadow-xl shadow-sky-accent/40 transform hover:scale-[1.05]">
                                        ${getDownloadIcon()}
                                        Get It
                                    </a>
                                    <!-- 2. Go To Store Button (Conditional) -->${storeButton}
                                </div>
                            ` : `<p class="mt-8 p-4 bg-sky-light rounded-lg text-sky-accent font-semibold">Details for this book are coming soon!</p>`}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderBooks(filteredBooks = booksData) {
            const bookCards = filteredBooks.map(book => `
                <div class="book-card bg-white p-4 rounded-xl text-center cursor-pointer border border-sky-light"
                    onclick="navigate('book-detail', ${book.id})">
                    <!-- Book Cover --><img src="${book.coverUrl}" alt="${book.title} cover" class="w-full h-auto object-cover rounded-lg mx-auto shadow-md"
                        onerror="this.onerror=null;this.src='https://placehold.co/150x225/f0f9ff/101010?text=I&O';" loading="lazy">

                    <!-- Title --><p class="mt-3 text-sm font-semibold text-obsidian">${book.title}</p>
                </div>
            `).join('');

            // NEW ADVANCED SEARCH BAR STRUCTURE
            return `
                <h1 class="text-4xl font-black mb-4 text-sky-accent text-center">Our Books</h1>

                <!-- Search Bar Container (Flex for centering, max-w for desktop limit) --><div class="flex justify-center mb-10">
                    <div class="max-w-xl w-full flex justify-center">
                        <!-- Dynamic Search Wrapper --><div id="search-bar-wrapper" class="relative h-12 w-12 transition-all duration-500 ease-in-out">
                            
                            <!-- Input Field: Absolute positioning to expand left from the button --><input type="text" id="book-search-input" oninput="filterBooks(this.value)"
                                class="absolute right-0 h-full p-3 pl-6 pr-16 border-2 border-sky-light rounded-full text-lg opacity-0 w-0 input-focus 
                                       transition-all duration-500 ease-in-out bg-white"
                                placeholder="Search titles..."
                                aria-label="Search book titles">
                            
                            <!-- Toggle Search Button: Fixed on the right edge (z-index for stacking and pushing) --><button onclick="toggleSearch()" id="search-toggle-btn" 
                                class="absolute right-0 top-0 p-3 bg-sky-accent text-white rounded-full transition duration-300 transform hover:scale-105 shadow-lg shadow-sky-accent/20 z-10"
                                aria-label="Toggle search bar visibility">
                                ${getSearchIcon()}
                            </button>

                        </div>
                    </div>
                </div>

                <!-- Book Grid (6 books per row - adjusted to automatically fit content) --><div id="book-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-6">
                    ${bookCards}
                </div>
            `;
        }

        /**
         * Filters the books based on the first 3 letters of the title.
         * Renders the filtered results.
         */
        function filterBooks(query) {
            const lowercaseQuery = query.toLowerCase().trim();
            let results;

            if (lowercaseQuery.length >= 3) {
                // Filter actual books by title starting with the query
                results = booksData.filter(book =>
                    !book.placeholder && book.title.toLowerCase().startsWith(lowercaseQuery)
                );
            } else if (lowercaseQuery.length === 0) {
                // Show all actual books if search is empty
                results = booksData.filter(book => !book.placeholder);
            } else {
                // Show a message or just keep the current list until 3 chars are typed
                results = booksData.filter(book => !book.placeholder);
            }

            const bookGrid = document.getElementById('book-grid');

            const filteredCards = results.map(book => `
                <div class="book-card bg-white p-4 rounded-xl text-center cursor-pointer border border-sky-light"
                    onclick="navigate('book-detail', ${book.id})">
                    <!-- Book Cover --><img src="${book.coverUrl}" alt="${book.title} cover" class="w-full h-auto object-cover rounded-lg mx-auto shadow-md"
                        onerror="this.onerror=null;this.src='https://placehold.co/150x225/f0f9ff/101010?text=I&O';" loading="lazy">

                    <!-- Title --><p class="mt-3 text-sm font-semibold text-obsidian">${book.title}</p>
                </div>
            `).join('');

            bookGrid.innerHTML = filteredCards || `<p class="col-span-full text-center text-lg text-gray-500 pt-8">No books found matching the search criteria. Please try again.</p>`;
        }

        /**
         * Toggles the visibility and expansion of the advanced search bar.
         */
        function toggleSearch() {
            const wrapper = document.getElementById('search-bar-wrapper');
            const input = document.getElementById('book-search-input');
            const button = document.getElementById('search-toggle-btn');
            
            // Define expanded width based on screen size for responsiveness
            function getExpandedWidth() {
                if (window.innerWidth >= 1024) {
                    return '30rem'; // Desktop/large
                } else if (window.innerWidth >= 640) {
                    return '20rem'; // Tablet/medium
                } else {
                    return '90vw'; // Mobile/small (90% of viewport width)
                }
            }


            isSearchVisible = !isSearchVisible;

            if (isSearchVisible) {
                // Expand and show
                wrapper.style.width = getExpandedWidth();
                input.classList.remove('w-0', 'opacity-0');
                input.classList.add('w-full', 'opacity-100', 'rainbow-active'); 
                button.classList.add('search-icon-shining'); 
                
                setTimeout(() => {
                    input.focus();
                }, 500); // Focus after transition
            } else {
                // Collapse and hide
                input.classList.remove('w-full', 'opacity-100', 'rainbow-active');
                button.classList.remove('search-icon-shining');
                
                // Wait briefly for the input's opacity/width transition to start before collapsing the wrapper
                setTimeout(() => {
                    wrapper.style.width = '3rem'; // Collapse back to button size
                    input.classList.add('w-0', 'opacity-0');
                    input.value = '';
                    filterBooks(''); // Reset filter
                    input.blur();
                }, 400); 
            }
        }


        // --- Navigation and Main Rendering Logic ---

        /**
         * Manages client-side routing and page transitions.
         * @param {string} page - The target page key ('home', 'series', 'series-detail', 'books', 'author', 'contact', 'book-detail').
         * @param {number|string|null} [id=null] - Optional ID (book ID or series ID) for detail views.
         */
        function navigate(page, id = null) {
            const container = document.getElementById('content-container');
            const navLinksDesktop = document.querySelectorAll('.nav-link');
            const navLinksMobile = document.querySelectorAll('.mobile-nav-link');
            const allNavLinks = [...navLinksDesktop, ...navLinksMobile];

            // 1. Start Exit Animation
            container.classList.remove('active');

            // 2. Update State
            // Track the immediate source page when entering a detail view
            if (page === 'book-detail' && id !== null) {
                // Check if the source was a series detail page
                if (currentPage === 'series' || currentPage === 'series-detail') {
                    backButtonRoute = { page: 'series', id: null };
                } else {
                    // Source was 'books' or 'home'
                    backButtonRoute = { page: 'books', id: null };
                }
            } else if (page === 'series-detail') {
                 backButtonRoute = { page: 'series', id: id };
            } else {
                // For all other main pages, reset or update current page tracker
                backButtonRoute = { page: page, id: id };
            }

            currentPage = page;
            currentBookId = page === 'book-detail' ? id : null;
            let currentSeriesId = (page === 'series-detail' || page === 'series') ? id : null;

            // 3. Wait for Exit Animation to complete before rendering new content
            setTimeout(() => {
                let htmlContent = '';

                switch (page) {
                    case 'home':
                        htmlContent = renderHome();
                        break;
                    case 'author':
                        htmlContent = renderAuthor();
                        break;
                    case 'contact':
                        htmlContent = renderContact();
                        break;
                    case 'series':
                        htmlContent = renderSeriesList();
                        break;
                    case 'series-detail':
                        htmlContent = renderSeriesDetail(id);
                        break;
                    case 'books':
                        htmlContent = renderBooks();
                        // Reset search visibility state when moving to books page
                        isSearchVisible = false;
                        break;
                    case 'book-detail':
                        htmlContent = renderBookDetail(id);
                        break;
                    default:
                        htmlContent = renderHome(); // Default to home
                }

                container.innerHTML = htmlContent;

                // 4. Start Entry Animation
                container.classList.add('active');

                // 5. Update Navigation Styling
                allNavLinks.forEach(link => {
                    // Determine the active link key
                    let activeKey = page;
                    if (page === 'book-detail') {
                        // Highlight the category the user came from
                        activeKey = backButtonRoute.page;
                    } else if (page === 'series-detail') {
                        // Highlight the 'series' link
                        activeKey = 'series';
                    }

                    // Check both desktop and mobile links
                    if (link.getAttribute('data-page') === activeKey) {
                        link.classList.add('active-nav');
                    } else {
                        link.classList.remove('active-nav');
                    }
                });

                // Special handling for Our Books search bar initialization
                if (page === 'books') {
                    const searchWrapper = document.getElementById('search-bar-wrapper');
                    // Ensure search wrapper is collapsed on initial load of the books page
                    if (searchWrapper) {
                         searchWrapper.style.width = '3rem';
                         // Also reset input state just in case
                         const input = document.getElementById('book-search-input');
                         const button = document.getElementById('search-toggle-btn');

                         input.classList.remove('w-full', 'opacity-100', 'rainbow-active');
                         button.classList.remove('search-icon-shining');
                         input.classList.add('w-0', 'opacity-0');
                         input.value = '';
                         filterBooks(''); 
                    }
                }

                window.scrollTo({ top: 0, behavior: 'smooth' });

            }, 400); // Transition time (0.4s)
        }

        // Initialize the page on load
        window.onload = () => {
            // 1. The 'home' content is pre-rendered. Ensure nav reflects 'home' as active.
            const navLinksDesktop = document.querySelectorAll('.nav-link');
            const navLinksMobile = document.querySelectorAll('.mobile-nav-link');
            const allNavLinks = [...navLinksDesktop, ...navLinksMobile];
            
            allNavLinks.forEach(link => {
                if (link.getAttribute('data-page') === 'home') {
                    link.classList.add('active-nav');
                } else {
                    link.classList.remove('active-nav');
                }
            });
            currentPage = 'home'; // Set initial state
        };

    </script>
</body>
</html>


















